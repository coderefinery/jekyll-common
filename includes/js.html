<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="{{ site.baseurl }}/jekyll-common/assets/js/bootstrap-3.3.7.min.js"></script>
<script src="{{ site.baseurl }}/jekyll-common/assets/js/lesson.js"></script>

<script src="{{ site.baseurl }}/jekyll-common/assets/js/anchor.min.js"></script>
<script>
    anchors.add();

    // https://github.com/twbs/bootstrap/issues/1768#issuecomment-6531466
    var shiftWindow = function() { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
</script>

<script src="http://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML&delayStartupUntil=configured" type="text/javascript">
</script>

<script type="text/javascript">
    MathJax.Hub.Config({
        tex2jax: {
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
          inlineMath: [['$','$'], ['\\(','\\)']],
          processEscapes: true
        },
        "TeX": {
          Macros: {AA : "{\\unicode{x212B}}"},
          extensions: ["autoload-all.js"]
        },
        "HTML-CSS": {
          scale: 90
        }
    });
    MathJax.Hub.Queue(function() {
        $(MathJax.Hub.getAllJax()).map(function(index, elem) {
            return(elem.SourceElement());
        }).parent().addClass('has-jax');
    });
    MathJax.Hub.Register.StartupHook("TeX autoload-all Ready", function () {
      var MACROS = MathJax.InputJax.TeX.Definitions.macros;
      MACROS.color = "Color";
      delete MACROS.colorbox;
      delete MACROS.fcolorbox;
    });
    MathJax.Hub.Configured();
</script>

// Presentation mode scrolling
<script>
    // Add goTo method to elements
    // http://stackoverflow.com/questions/4801655/how-to-go-to-a-specific-element-on-page
    (function($) {
        $.fn.goTo = function() {
            $('html, body').animate({
                scrollTop: $(this).offset().top //+ 'px'
            }, 'fast');
            return this; // for chaining...
        }
    })(jQuery);

    function do_scroll(delta) {
        // scroll `delta` sections forward or backwards

        // els: list of all elements which are possible slide scroll
        // targets
        var els = $("h2");
        var cur_pos = 0;

        // cur_pos: Find where we currently are within the list of
        // elements (this is cur_pos).
        for(i=0; i<els.size(); i++) {
            //if ( window.pageYOffset < els[i].getBoundingClientRect()["top"] ) {
            //console.log(els[i], els[i].getBoundingClientRect()["top"])
            if ( els[i].getBoundingClientRect()["top"] < window.innerHeight/2 ) {
                continue;
            }
            //console.info(els[i], els[i].getBoundingClientRect()["top"]);
            cur_pos = i-1;
            //console.info(els[cur_pos])
            break;
        }

        // Find next element we should scroll too, or return if we go
        // out of bounds.
        if ( i+delta < 0 || i+delta > els.size -1  ) {
            return;
        }
        next_elem = els[cur_pos+delta];

        // Figure out how to roughly center the element in the screen.
        // The logic is, if it's less than the screen, center it but
        // move it slightly to the top.
        //var top = next_elem.getBoundingClientRect()["y"];
        var top = $(next_elem).offset()["top"];  // top of this element
        var height = next_elem.getBoundingClientRect()["height"];  // height of this element
        var win_height = window.innerHeight;
        //console.info(top, height, win_height)
        var scroll_to = 0;
	// Removed: The following worked only when searching for <div>
	// items that had a height - <h2> elementes have a fixed
	// height, thus something smarter is needed.
        ////if (height >= win_height) {
        ////    scroll_to = top;
        ////} else {
        ////    scroll_to = top - (win_height-height)/3.;
        ////}
        //////console.info(top, height, win_height, scroll_to)
	scroll_to = top - (win_height/10);

        //$(next_elem).goTo();
        //window.scroll(0, scroll_to);
        $('html, body').animate({
            scrollTop: scroll_to //+ 'px'
        }, 'fast');

    }

    // Key handler
    document.addEventListener('keydown', function (event) {
        switch(event.which) {
            case 37: // left
                do_scroll(-1);
                event.preventDefault();
                return false;
                break;
	          //case 38: // up
            case 39: // right
                do_scroll(+1);
                event.preventDefault();
                return false;
                break;
            //case 40: // down
            default:
                return; // exit this handler for other keys
        }
    }, true)


</script>
